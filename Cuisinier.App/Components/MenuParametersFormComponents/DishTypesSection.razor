@using MudBlazor

<MudDivider Class="my-4" />
<MudText Typo="Typo.h6" Class="mb-2">Types de plats</MudText>
<MudText Typo="Typo.body2" Class="mb-3 helper-text-secondary">Le nombre est optionnel</MudText>

<div class="types-plats-container">
    @for (int i = 0; i < TypesValues.Count; i++)
    {
        var index = i;
        var localIndex = index;
        int? localValue = localIndex < NumberValues.Count ? NumberValues[localIndex] : null;
        <MudPaper Elevation="1" Class="type-plat-card mb-2">
            <div class="type-plat-content">
                <MudStack Row="true" Spacing="2" AlignItems="AlignItems.Center" Class="type-plat-row">
                    <MudSelect T="string" 
                              Value="@TypesValues[index]"
                              ValueChanged="@((string value) => {
                                  TypesValues[index] = value;
                                  OnChange.InvokeAsync();
                              })"
                              Label="Type de plat"
                              Variant="Variant.Outlined">
                        @foreach (var typeOption in TypeOptions)
                        {
                            <MudSelectItem Value="@typeOption">@typeOption</MudSelectItem>
                        }
                    </MudSelect>
                    
                    <MudNumericField T="int?" 
                                    Value="@localValue"
                                    ValueChanged="@((int? value) => {
                                        while (NumberValues.Count <= localIndex)
                                        {
                                            NumberValues.Add(null);
                                        }
                                        NumberValues[localIndex] = value;
                                        OnChange.InvokeAsync();
                                    })"
                                    Label="Nombre"
                                    Min="1"
                                    Max="20"
                                    Variant="Variant.Outlined" />
                    
                    <MudIconButton Icon="@Icons.Material.Filled.Delete" 
                                  Color="Color.Error" 
                                  Size="Size.Small"
                                  Variant="Variant.Text"
                                  OnClick="@(() => OnRemove.InvokeAsync(index))"
                                  Class="delete-type-button" />
                </MudStack>
            </div>
        </MudPaper>
    }
</div>

<MudButton Variant="Variant.Text"
          StartIcon="@Icons.Material.Filled.Add"
          OnClick="OnAdd"
          FullWidth="true"
          Class="mb-4 mt-3">
    Ajouter un type de plat
</MudButton>

<style>
    .type-plat-row .mud-select {
        min-width: 160px;
        max-width: 160px;
    }

    .type-plat-row .mud-input-control {
        flex-shrink: 0;
    }

    @@media (max-width: 600px) {
        .type-plat-row {
            flex-wrap: wrap;
        }

        .type-plat-row .mud-select {
            min-width: 100%;
            max-width: 100%;
        }
    }
</style>

@code {
    [Parameter] public List<string> TypeOptions { get; set; } = new();
    [Parameter] public List<string> TypesValues { get; set; } = new();
    [Parameter] public List<int?> NumberValues { get; set; } = new();
    [Parameter] public EventCallback<int> OnRemove { get; set; }
    [Parameter] public EventCallback OnAdd { get; set; }
    [Parameter] public EventCallback OnChange { get; set; }
}

