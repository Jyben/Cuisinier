@page "/"
@attribute [Microsoft.AspNetCore.Authorization.Authorize]
@using Cuisinier.App.Components.MenuParametersWizard
@using Cuisinier.App.Services
@using Cuisinier.Shared.DTOs
@using Cuisinier.Shared.Helpers
@using MudBlazor
@inject IMenuApi MenuApi
@inject ISnackbar Snackbar

<PageTitle>Configuration du menu</PageTitle>

<PageHeader Title="Configuration du menu" />

@if (_loading)
{
    <MudProgressLinear Color="Color.Primary" Indeterminate="true" />
}
else
{
    <MenuParametersWizard Parameters="@_parameters" />
}

@code {
    private MenuParameters _parameters = new();
    private bool _loading = true;

    protected override async Task OnInitializedAsync()
    {
        try
        {
            var lastParameters = await MenuApi.GetLastParametersAsync();
            if (lastParameters != null)
            {
                // Migration is handled by the wizard's EnsureValidParameters
                _parameters = lastParameters;
            }
        }
        catch
        {
            // In case of error, continue with default parameters
        }
        finally
        {
            _loading = false;
        }
    }
}
